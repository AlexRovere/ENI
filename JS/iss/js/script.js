async function callApi () {
  let res = await fetch('http://api.open-notify.org/iss-now.json')
  return res.json()
}

let { iss_position: position } = await callApi()
let latitude = position.latitude
let longitude = position.longitude
let map = L.map('map').setView([latitude, longitude], 5);
// let marker = L.marker([latitude, longitude]).addTo(map);

let avionIcon = L.icon({
  iconUrl: "data:image/png;base64,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",
  iconSize: [32, 32],
  iconAnchor: [16, 16],
  popupAnchor: [0, -16]
});

// Ajouter le marqueur avec l'icône d'avion à la carte à une position spécifique
let marker = L.marker([latitude, longitude], { icon: avionIcon }).addTo(map)
  .bindPopup('ISS en approche !')
  .openPopup();

L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);


setInterval(async () => {
  let { iss_position: position } = await callApi()
  updateMap(position.latitude, position.longitude)
}, 5000);

function updateMap (latitude, longitude) {
  document.getElementById("latitude").innerText = latitude
  document.getElementById("longitude").innerText = longitude
  map.setView([latitude, longitude])
  marker.setLatLng([latitude, longitude])
}